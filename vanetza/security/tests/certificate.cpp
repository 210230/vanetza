#include <gtest/gtest.h>
#include <vanetza/security/certificate.hpp>
#include <vanetza/security/tests/check_certificate.hpp>
#include <vanetza/security/tests/serialization.hpp>

using namespace vanetza::security;

TEST(Certificate, WebValidator_RootCA)
{
    const char str[] =
        "010100040D50696C6F74504B495F526F6F74808900000410C1B6C130E84711B558E69CE0FBC17DE6"
        "B9A6C42BB7E1B962EF4CD5B07DADF8D214C65D8B7BD24ACCE01EDFE5F186A94217DE25E454763F5D"
        "83A1161860D6FC010100049B7D10065669DFE403CEB43E2A57B8061C86B9B8A0ADF2ECE2FEFD5A09"
        "872525B89F1D8732A4D761E68446C23FB845CD5C8172D3067B9C61CDEFBD6923C1FBC002E00B0105"
        "A4EC0110EC21010300000008610502F11FC54CA9D198DE0177DD571F12E5945A771E20CEDA080A00"
        "FBFC0D00B0B38F6AC60C18F2CD79D90C2AFE45BD76349E0454817E184F92BF87D7C9B4";
    Certificate c;
    deserialize_from_hexstring(str, c);
    check(c, serialize_roundtrip(c));
}

TEST(Certificate, WebValidator_EnrollmentAuthority)
{
    const char str[] =
        "0180EC02010100040D50696C6F74504B495F526F6F74808900000410C1B6C130E84711B558E69CE0"
        "FBC17DE6B9A6C42BB7E1B962EF4CD5B07DADF8D214C65D8B7BD24ACCE01EDFE5F186A94217DE25E4"
        "54763F5D83A1161860D6FC010100049B7D10065669DFE403CEB43E2A57B8061C86B9B8A0ADF2ECE2"
        "FEFD5A09872525B89F1D8732A4D761E68446C23FB845CD5C8172D3067B9C61CDEFBD6923C1FBC002"
        "E00B0105A4EC0110EC21010300000008610502F11FC54CA9D198DE0177DD571F12E5945A771E20CE"
        "DA080A00FBFC0D00B0B38F6AC60C18F2CD79D90C2AFE45BD76349E0454817E184F92BF87D7C9B403"
        "0D50696C6F74504B495F4C5443418089000004952AD9BB6A2DF1D21E252FB87EDA8160CD4B6F671D"
        "8154BC6FA164A879E5B54DD7D92EECABBD882C0E30BD855757F5B51C888890AADE9CBD9859F729FB"
        "6BCDA10101000400D72336027966C93C815C548F279E0D226AD39F5D8634D5A1B64541E1A87F025C"
        "3E790B1394DD0CCD9898C0C0AC51F56B2D265AF118E64953C4B2BA64324AAD02E00B0105A4EC0110"
        "EC210103000000968ACF98D59BADC6989D38EF2BBE767D0F075F34333F158FE73C98876AD67794AD"
        "47A557AB3BAE315BD7E8719FAE36B3FE20B4AB4DE5FC5A21E84A3989E273C6";
    Certificate c;
    deserialize_from_hexstring(str, c);
    check(c, serialize_roundtrip(c));
}

TEST(Certificate, WebValidator_AuthorizationAuthority1)
{
    const char str[] =
        "01090183CA2168B784FC6C021050696C6F74504B495F5043415F53495480910000040D4661BF77F6"
        "71716EA74EA4CD92EF5A4566BEEA6681ED044B09C31EA47D42B388932A9B2DA957F3FD2E1256DAC8"
        "069B1544BF2988D43EF09B8AABC67813465E010100043361E73DFF9BC89C42F4542AAC7FDD9A5ABA"
        "66531087D1C31C5A95B6788E06BC08F9402D3ED4756A6FB06937F2A919833841358D052FB6C9AF4C"
        "C1F684C3B76A02E02006C04080C040810B0105A4EC0110EC210103000000C64E89A23528F50D8AF8"
        "536290FE9E78CC26F51D6B4278EC086383A4AFEABA961AD38A2FB286D0F075DEDB0C7929960D3586"
        "5E80A3A022CAC772F1DACA6F875A";
    Certificate c;
    deserialize_from_hexstring(str, c);
    check(c, serialize_roundtrip(c));
}

TEST(Certificate, WebValidator_AuthorizationAuthority2)
{
    const char str[] =
        "01090183CA2168B784FC6C021050696C6F74504B495F5043415F5349548089000004732CA0163B0E"
        "3CD6DE8789FED98DE772F3D54EBFF1D44ED556B683B0D8AE837C8B1EB52F25377244298655CDCB3D"
        "3CCEA8CEDA1AA5E57920C97FEC38F2237B0B0101000412FD16EA68D73575651CD7AED08023CFDC38"
        "AEE3CCAA178D672AB30A6FE7803CAEFCF1F79A373C7D77D84AE2DD079229D50E5745CD73398FB69D"
        "902617A6AAB602E00B0105A4EC0110EC210103000000A9A8140518E0C66DED7568E103C9D3927CF8"
        "3B6D4692B7FA013BE586FB6BA7A17F0DD28FE14317E2B9F141084166F24F0CBD06AB926197F5F6A3"
        "9C6003640E64";
    Certificate c;
    deserialize_from_hexstring(str, c);
    check(c, serialize_roundtrip(c));
}

TEST(Certificate, WebValidator_AuthorizationAuthority3)
{
    const char str[] =
        "0180EC02010100040D50696C6F74504B495F526F6F74808900000410C1B6C130E84711B558E69CE0"
        "FBC17DE6B9A6C42BB7E1B962EF4CD5B07DADF8D214C65D8B7BD24ACCE01EDFE5F186A94217DE25E4"
        "54763F5D83A1161860D6FC010100049B7D10065669DFE403CEB43E2A57B8061C86B9B8A0ADF2ECE2"
        "FEFD5A09872525B89F1D8732A4D761E68446C23FB845CD5C8172D3067B9C61CDEFBD6923C1FBC002"
        "E00B0105A4EC0110EC21010300000008610502F11FC54CA9D198DE0177DD571F12E5945A771E20CE"
        "DA080A00FBFC0D00B0B38F6AC60C18F2CD79D90C2AFE45BD76349E0454817E184F92BF87D7C9B402"
        "1050696C6F74504B495F5043415F5349548089000004B25F258C4E10D460F62F11D1F54BEACFF521"
        "E7F4758EE73A8623B23536A562EA915F470098485FC1E3CC6344FD741E5AF491CCE8E9D7F47411E6"
        "07B75B8F7899010100047B9C36689AD2C056DFF9027903558959B28C0830B98C2303D7EDF61EE466"
        "122270709E833B71C012C248A742669212EBD2E355881F7AC1192A782D2D3D1BB40702E00B0105A4"
        "EC0110EC2101030000002F04BDFC9342276F28BBA11B771F9530E910D1B00ADA4B1EC02C6D591F9E"
        "ED7652F683DAEFC0C73CDD2D5A243CE64DA46BC952493A29320782B308B051F8492D";
    Certificate c;
    deserialize_from_hexstring(str, c);
    check(c, serialize_roundtrip(c));
}

